create database employee;
use employee;
-- Create DEPT table
CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50) NOT NULL,
    DLOC VARCHAR(50)
);
select * from DEPT;
-- Create EMPLOYEE table
CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50) NOT NULL,
    MGR_NO INT,
    HIREDATE DATE,
    SAL DECIMAL(10,2),
    DEPTNO INT,
    CONSTRAINT fk_emp_dept FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO),
    CONSTRAINT fk_emp_mgr FOREIGN KEY (MGR_NO) REFERENCES EMPLOYEE(EMPNO)
);

-- Create PROJECT table
CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PLOC VARCHAR(50),
    PNAME VARCHAR(100) NOT NULL
);

-- Create ASSIGNED_TO table (relationship between EMPLOYEE and PROJECT)
CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    CONSTRAINT fk_assigned_emp FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    CONSTRAINT fk_assigned_proj FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

-- Create INCENTIVES table
CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10,2),
    PRIMARY KEY (EMPNO, INCENTIVE_DATE),
    CONSTRAINT fk_incentive_emp FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);

-- Insert data into DEPT table
INSERT INTO DEPT VALUES (10, 'Research', 'Bengaluru');
INSERT INTO DEPT VALUES (20, 'Development', 'Hyderabad');
INSERT INTO DEPT VALUES (30, 'Marketing', 'Mysuru');
INSERT INTO DEPT VALUES (40, 'Sales', 'Bengaluru');
INSERT INTO DEPT VALUES (50, 'HR', 'Chennai');
INSERT INTO DEPT VALUES (60, 'Finance', 'Mumbai');

-- Insert data into EMPLOYEE table
INSERT INTO EMPLOYEE VALUES (1001, 'Rajesh Kumar', NULL, '2020-01-15', 75000, 10);
INSERT INTO EMPLOYEE VALUES (1002, 'Priya Sharma', 1001, '2020-03-20', 65000, 10);
INSERT INTO EMPLOYEE VALUES (1003, 'Amit Patel', 1001, '2021-05-10', 55000, 20);
INSERT INTO EMPLOYEE VALUES (1004, 'Sneha Reddy', NULL, '2019-11-05', 80000, 20);
INSERT INTO EMPLOYEE VALUES (1005, 'Vikram Singh', 1004, '2021-08-22', 60000, 30);
INSERT INTO EMPLOYEE VALUES (1006, 'Ananya Nair', 1004, '2022-02-14', 58000, 40);
INSERT INTO EMPLOYEE VALUES (1007, 'Karthik Raj', 1001, '2020-07-18', 62000, 50);

-- Insert data into PROJECT table
INSERT INTO PROJECT VALUES (101, 'Bengaluru', 'AI Research Project');
INSERT INTO PROJECT VALUES (102, 'Hyderabad', 'Cloud Migration');
INSERT INTO PROJECT VALUES (103, 'Mysuru', 'Mobile App Development');
INSERT INTO PROJECT VALUES (104, 'Bengaluru', 'Data Analytics Platform');
INSERT INTO PROJECT VALUES (105, 'Chennai', 'Cybersecurity Enhancement');
INSERT INTO PROJECT VALUES (106, 'Mumbai', 'ERP Implementation');

-- Insert data into ASSIGNED_TO table
INSERT INTO ASSIGNED_TO VALUES (1001, 101, 'Project Manager');
INSERT INTO ASSIGNED_TO VALUES (1002, 101, 'Senior Developer');
INSERT INTO ASSIGNED_TO VALUES (1003, 102, 'Tech Lead');
INSERT INTO ASSIGNED_TO VALUES (1004, 102, 'Architect');
INSERT INTO ASSIGNED_TO VALUES (1005, 103, 'Developer');
INSERT INTO ASSIGNED_TO VALUES (1006, 104, 'Business Analyst');
INSERT INTO ASSIGNED_TO VALUES (1007, 105, 'Security Engineer');

-- Insert data into INCENTIVES table
INSERT INTO INCENTIVES VALUES (1001, '2023-06-30', 15000);
INSERT INTO INCENTIVES VALUES (1002, '2023-06-30', 12000);
INSERT INTO INCENTIVES VALUES (1003, '2023-12-31', 10000);
INSERT INTO INCENTIVES VALUES (1004, '2023-06-30', 18000);
INSERT INTO INCENTIVES VALUES (1006, '2024-01-15', 8000);
INSERT INTO INCENTIVES VALUES (1007, '2023-12-31', 11000);

-- iii. Retrieve employee numbers working on projects in Bengaluru, Hyderabad, or Mysuru
SELECT DISTINCT e.EMPNO
FROM EMPLOYEE e
JOIN ASSIGNED_TO a ON e.EMPNO = a.EMPNO
JOIN PROJECT p ON a.PNO = p.PNO
WHERE p.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');

-- iv. Get Employee IDs who didn't receive incentives
SELECT EMPNO
FROM EMPLOYEE
WHERE EMPNO NOT IN (SELECT EMPNO FROM INCENTIVES);

-- v. Employees working on projects in same location as their department
SELECT
    e.ENAME,
    e.EMPNO,
    e.DEPTNO,
    a.JOB_ROLE,
    d.DLOC AS DEPARTMENT_LOCATION,
    p.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE e
JOIN DEPT d ON e.DEPTNO = d.DEPTNO
JOIN ASSIGNED_TO a ON e.EMPNO = a.EMPNO
JOIN PROJECT p ON a.PNO = p.PNO
WHERE d.DLOC = p.PLOC;